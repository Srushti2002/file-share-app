# Deployment Guide - Render

This guide walks you through deploying the File Share App to Render.

## Prerequisites

1. A [Render account](https://render.com) (free tier available)
2. A MongoDB Atlas cluster (or another MongoDB hosting solution)
3. Your code pushed to a Git repository (GitHub, GitLab, or Bitbucket)

## Deployment Steps

### 1. Prepare Your Repository

Ensure all changes are committed and pushed to your Git repository:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### 2. Create a New Blueprint on Render

1. Log in to your [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** → **"Blueprint"**
3. Connect your Git repository
4. Render will automatically detect the `render.yaml` file

### 3. Configure Environment Variables

Before deploying, you need to set up the following environment variables in Render:

#### Backend Service Environment Variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `MONGO_URI` | MongoDB connection string | `mongodb+srv://user:pass@cluster.mongodb.net/fileShareDB` |
| `JWT_SECRET` | Secret key for JWT tokens | Auto-generated by Render |
| `CLIENT_ORIGINS` | Allowed frontend URLs (comma-separated) | `https://your-frontend.onrender.com` |
| `API_BASE_URL` | Public URL of your backend | `https://your-backend.onrender.com` |

#### Frontend Service Environment Variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `VITE_API_URL` | Backend API URL | `https://your-backend.onrender.com/api` |

**Important:** After creating the services, you'll know the actual URLs. Update `CLIENT_ORIGINS` and `VITE_API_URL` accordingly.

### 4. Deploy the Services

1. After connecting your repository, Render will show you a preview of the services defined in `render.yaml`:
   - **file-share-backend** (Web Service)
   - **file-share-frontend** (Static Site)

2. Review the configuration and click **"Apply"**

3. Render will:
   - Install dependencies
   - Build the frontend
   - Start the backend service
   - Deploy both services

### 5. Update Environment Variables with Actual URLs

Once deployment completes:

1. Note your service URLs:
   - Backend: `https://file-share-backend-XXXX.onrender.com`
   - Frontend: `https://file-share-frontend-XXXX.onrender.com`

2. Update the backend environment variables:
   - `CLIENT_ORIGINS`: `https://file-share-frontend-XXXX.onrender.com`
   - `API_BASE_URL`: `https://file-share-backend-XXXX.onrender.com`

3. Update the frontend environment variables:
   - `VITE_API_URL`: `https://file-share-backend-XXXX.onrender.com/api`

4. After updating environment variables, Render will automatically redeploy the services.

### 6. Set Up MongoDB

If you haven't already:

1. Create a free MongoDB Atlas cluster at [mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
2. Create a database user
3. Whitelist Render's IP addresses (or use `0.0.0.0/0` for all IPs)
4. Get your connection string and add it to `MONGO_URI` in Render

## Important Notes

### Free Tier Limitations

- **Backend service**: Will spin down after 15 minutes of inactivity. First request after inactivity will take ~30 seconds.
- **Disk storage**: 1GB persistent disk for file uploads (can be upgraded if needed)
- **Bandwidth**: 100GB/month on free tier

### File Uploads

The backend uses persistent disk storage mounted at `/backend/uploads`. Files are stored locally on the Render server and persist across deployments.

### CORS Configuration

The backend is configured to accept requests from the origins specified in `CLIENT_ORIGINS`. Make sure this includes your frontend URL.

### Custom Domains (Optional)

You can add custom domains to both services:
1. Go to your service settings in Render
2. Click "Custom Domain"
3. Follow the instructions to configure your DNS

## Monitoring

- **Logs**: View real-time logs in the Render dashboard for each service
- **Health Checks**: Backend includes a `/api/health` endpoint that Render monitors
- **Metrics**: Render provides CPU, memory, and bandwidth usage metrics

## Troubleshooting

### Backend won't start
- Check the logs in Render dashboard
- Verify `MONGO_URI` is correct
- Ensure all required environment variables are set

### Frontend can't connect to backend
- Verify `VITE_API_URL` points to the correct backend URL (including `/api`)
- Check backend `CLIENT_ORIGINS` includes your frontend URL
- Look for CORS errors in browser console

### File uploads failing
- Check disk storage hasn't exceeded 1GB limit
- Verify `MAX_FILE_SIZE_MB` setting
- Check backend logs for errors

### 502 Bad Gateway
- Backend service may be spinning up (wait 30 seconds)
- Check backend logs for crashes
- Verify MongoDB connection

## Updating Your Application

When you push changes to your repository:
1. Render will automatically detect the changes
2. It will rebuild and redeploy your services
3. For frontend changes, the static site will be regenerated
4. For backend changes, the service will restart

## Manual Deployment

You can also manually trigger deployments from the Render dashboard:
1. Go to your service
2. Click "Manual Deploy" → "Deploy latest commit"

## Need Help?

- [Render Documentation](https://render.com/docs)
- [Render Community](https://community.render.com)
- Check service logs in the Render dashboard for detailed error messages
